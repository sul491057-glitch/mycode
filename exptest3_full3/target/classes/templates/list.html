<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>预订管理 - 餐厅系统</title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f0f2f5; font-family: "Helvetica Neue", Helvetica, "PingFang SC", Arial, sans-serif; }
        .main-container { background: white; border-radius: 4px; padding: 24px; box-shadow: 0 2px 12px 0 rgba(0,0,0,0.05); min-height: 85vh; }
        .navbar { background-color: #fff !important; box-shadow: 0 1px 4px rgba(0,21,41,0.08); }
        .nav-brand-custom { color: #409eff; font-weight: 600; font-size: 20px; }

        /* 表格样式 */
        .table thead th { background-color: #f5f7fa; color: #909399; font-weight: 600; border-bottom: none; height: 50px; vertical-align: middle; }
        .table td { color: #606266; vertical-align: middle; height: 55px; border-bottom: 1px solid #ebeef5; }
        .table-hover tbody tr:hover { background-color: #f5f7fa; }

        /* 按钮样式 */
        .btn-primary { background-color: #409eff; border-color: #409eff; }
        .btn-primary:hover { background-color: #66b1ff; border-color: #66b1ff; }
        .btn-success { background-color: #67c23a; border-color: #67c23a; }
        .btn-success:hover { background-color: #85ce61; border-color: #85ce61; }

        /* 操作链接 */
        .action-link { font-size: 14px; margin-right: 8px; cursor: pointer; }
        .link-edit { color: #409eff; text-decoration: none; }
        .link-del { color: #f56c6c; text-decoration: none; }
        .link-edit:hover, .link-del:hover { text-decoration: underline; }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top mb-4">
    <div class="container">
        <a class="navbar-brand nav-brand-custom" href="#"><i class="bi bi-shop-window me-2"></i>Restaurant Admin</a>
        <div class="ms-auto d-flex align-items-center">
            <span class="text-secondary me-3 small"><i class="bi bi-person-circle me-1"></i><span th:text="${session.user}"></span></span>
            <a href="/" class="btn btn-outline-secondary btn-sm" style="border-radius: 15px;">退出</a>
        </div>
    </div>
</nav>

<div class="container" style="margin-top: 80px;">
    <div class="main-container">
        <div class="row mb-4 g-3">
            <div class="col-md-5">
                <form action="/reservations" method="get" class="input-group">
                    <input type="text" name="query" class="form-control" placeholder="请输入客人姓名搜索..." th:value="${query}">
                    <button class="btn btn-primary" type="submit"><i class="bi bi-search me-1"></i>查询</button>
                </form>
            </div>
            <div class="col-md-7 text-end">
                <a href="/reservation/form" class="btn btn-success"><i class="bi bi-plus-lg me-1"></i>新增预订</a>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                <tr>
                    <th width="80">ID</th>
                    <th>客人姓名</th>
                    <th>联系电话</th>
                    <th>人数</th>
                    <th>预订时间</th>
                    <th>备注</th>
                    <th width="150">操作</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="r : ${reservations}">
                    <td th:text="${r.id}"></td>
                    <td>
                        <div class="fw-bold" th:text="${r.guestName}"></div>
                    </td>
                    <td th:text="${r.phoneNumber}"></td>
                    <td>
                                <span class="badge bg-info text-dark bg-opacity-10 text-primary border border-info border-opacity-25"
                                      th:text="${r.guestCount} + ' 人'"></span>
                    </td>
                    <td th:text="${r.reserveTime}" style="color: #909399; font-size: 14px;"></td>
                    <td th:text="${#strings.isEmpty(r.remarks) ? '-' : r.remarks}" class="text-truncate" style="max-width: 150px;"></td>
                    <td>
                        <a th:href="@{/reservation/form(id=${r.id})}" class="action-link link-edit">编辑</a>
                        <a href="javascript:void(0);" th:onclick="'showDeleteModal(' + ${r.id} + ')'" class="action-link link-del">删除</a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(reservations)}">
                    <td colspan="7" class="text-center py-5">
                        <div class="text-secondary opacity-50">
                            <i class="bi bi-inbox" style="font-size: 40px;"></i>
                            <p class="mt-2">暂无预订数据</p>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="width: 360px;">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 8px;">
            <div class="modal-body text-center p-4">
                <i class="bi bi-exclamation-circle-fill text-warning mb-3" style="font-size: 42px;"></i>
                <h5 class="mb-2 text-dark">确认删除该预订吗？</h5>
                <p class="text-secondary small mb-4">此操作无法撤销，请谨慎操作。</p>
                <div class="d-flex justify-content-center gap-3">
                    <button type="button" class="btn btn-light px-4" data-bs-dismiss="modal">取消</button>
                    <a id="confirmDeleteBtn" href="#" class="btn btn-danger px-4" style="background-color: #f56c6c; border: none;">确定</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    function showDeleteModal(id) {
        document.getElementById('confirmDeleteBtn').href = '/reservation/delete/' + id;
        var myModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        myModal.show();
    }
</script>
</body>
</html>